<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.project.library.mapper.ReviewMapper">

    <!-- request Body 요청 데이터를 DB에 저장-->
    <insert id="saveReview" parameterType="com.project.library.dto.request.ReviewRequestDto" useGeneratedKeys="true" keyProperty="id">

        INSERT INTO review (
             content, createdAt, writer, deleteStatus, memberId, bookId
        ) VALUES (
        #{content}
        , NOW()
        , #{writer}
        , true
        , #{memberId}
        , #{bookId}
        );

    </insert>

    <!-- Book title, writer로 조회   -->
    <select id="findReviewByBookId" resultType="com.project.library.dto.response.ReviewResponseDto">
        SELECT r.id
             , r.content
             , r.modifiedAt
             , r.writer
             , m.memberId
             , b.bookId
        FROM review AS r
                 INNER JOIN member AS m
                            ON r.memberId = m.id
                 INNER JOIN book AS b
                            ON r.bookId = b.id
        where b.id = #{bookId}


    </select>

</mapper>